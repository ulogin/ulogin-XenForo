# uLogin

Donate link: http://ulogin.ru
Tags: ulogin, login, social, authorization
Requires at least: 1.2
Tested up to: 1.4.5
Stable tag: 2.0
License: GNU General Public License, version 2

**uLogin** — это инструмент, который позволяет пользователям получить единый доступ к различным Интернет-сервисам без необходимости повторной регистрации,
а владельцам сайтов — получить дополнительный приток пользователей из социальных сетей и популярных порталов (Google, Яндекс, Mail.ru, ВКонтакте, Facebook и др.)

## Установка

- Скопировать все файлы и папки находящиеся в папке /upload в архиве в папку с xenForo (forum/library/uLogin/ и forum/js/uLogin/).
- Через административную панель установить дополнение. Для этого необходимо в открытом пункте меню "Install Add-on"  указать путь до файла addon-ulogin.xml(содержится в корне архива с дополнением).
- Для отображения виджета на главной странице необходимо исправить шаблон login_bar следующим образом:
Найти строку:

	`<h3 id="loginBarHandle">
		<label for="LoginControl"><a href="{xen:link login}" class="concealed noOutline">{xen:if $xenOptions.registrationSetup.enabled, {xen:phrase log_in_or_sign_up}, {xen:phrase log_in}}</a></label>
	</h3>`

Ниже добавить:

	`<xen:hook name="ulogin"></xen:hook>`

Шаблон можно редактировать через административную панель.

Более детальную информацию смотрите на сайте https://ulogin.ru/help.php

## Add-on "uLogin"

Данный модуль находится в панели администрации в разделе *Development* - *List Add-ons*.
Настройки модуля находятся в *Options* - *uloginOptions*

Здесь задаются:

**uLogin ID общая форма:** общее поле для всех виджетов uLogin, необязательный параметр (см. *"Настройки виджета uLogin"*);

**uLogin ID форма синхронизации:** поле для всех виджетов синхронизации uLogin, необязательный параметр (см. *"Настройки виджета uLogin"*);


## Настройки виджета uLogin

При установке расширения uLogin авторизация пользователей будет осуществляться с настройками по умолчанию.
Для более детальной настройки виджетов uLogin Вы можете воспользоваться сервисом uLogin.

Вы можете создать свой виджет uLogin и редактировать его самостоятельно:

для создания виджета необходимо зайти в Личный Кабинет (ЛК) на сайте http://ulogin.ru/lk.php
добавить свой сайт к списку Мои сайты и на вкладке Виджеты добавить новый виджет. После этого вы можете отредактировать свой виджет.

В графе «Возвращаемые поля профиля пользователя» вы можете включить поля **Пол** и **Дата рождения**, XenForo использует эти параметры
для записи в соответствующих полях пользователей.

**Важно!** Для успешной работы плагина необходимо включить в обязательных полях профиля поле **Еmail** в Личном кабинете uLogin.
Заполнять поля в графе «Тип авторизации» не нужно, т.к. расширение uLogin настроено на автоматическое заполнение данных параметров.

Созданный в Личном Кабинете виджет имеет параметры **uLogin ID**.
Скопируйте значение **uLogin ID** вашего виджета в соответствующее поле в настройках плагина на вашем сайте и сохраните настройки.

Если всё было сделано правильно, виджет изменится согласно вашим настройкам.


## Особенности

Для ручного вывода панели авторизации в любом месте шаблона XenForo используйте хук(hook)

	`<xen:hook name="ulogin"></xen:hook>`

**Внимание! по умолчанию передаётся uloginID общей формы**

Для использования панели авторизации в контроллерах XenForo используйте код функции

	`XenForo_Model::create('uLogin_Model_uloginModel')->getPanelCode();`

Например,

	`$panel = XenForo_Model::create('uLogin_Model_uloginModel')->getPanelCode(0);`

При этом необходимо передать переменную $panel в параметры шаблона, нарпимер,

	`$templateParams += array('panel' => $panel);`

и вывести переменную в самом шаблоне, например,

	`{xen:raw $panel}`


	`uLogin_Model_uLoginModel::getPanelCode($place = 0)
	/**
	* int $place - указывает, какую форму виджета необходимо выводить (0 - общая форма, 1 - форма синхронизации). Значение по умолчанию = 0.
	*/`

Для вывода списка аккаунтов пользователя используйте функцию

	`uLogin_Listener_Profile::getuLoginUserAccountsPanel()`

## Изменения

####2.0.0.
* Реализована настройка виджета из Личного кабинета uLogin.
* Реализована синхронизация учётных записей пользователя.
* Добавлена страница настроек виджета в административной панели.
* Добавлена страница настроек виджета по умолчанию в административной панели.
* Ряд других незначительных изменений.

####1.0.0.
* Релиз.